<!-- templates/view_previous_order.html -->
{% extends "layout.html" %}

{% block title %}Order Details | Soaporium{% endblock %}

{% block content %}
<!-- Flash Messages for Errors or Other Notifications -->
{% with messages = get_flashed_messages(with_categories=True) %}
{% if messages %}
<div class="flash-messages">
    {% for category, message in messages %}
    <div class="alert {{ category }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

<div class="cart-container">
    <h1>Order Details</h1>

    {% if cart_items and cart_items|length > 0 %}
    <ul>
        {% for item in cart_items %}
        <li class="cart-item">
            <h2>{{ item.soap_name }}</h2> <!-- Soap name -->
            <p>Quantity: {{ item.soap_quantity }}</p> <!-- Total quantity for each soap -->
            <p>Unit Price: ${{ item.unit_price }}</p> <!-- Unit price -->
            <p>Total Price: ${{ item.total_unit_price }}</p> <!-- Total price for each soap -->

            <!-- Check if item exists in cart_quantities -->
            {% if item.soapid in cart_quantities %}
            <div class="cart-quantity">
                <!-- Form to decrease quantity -->
                <form action="{{ url_for('decrease_quantity', soapid=item.soapid) }}" method="POST">
                    <input type="hidden" name="redirect_url" value="{{ request.url }}">
                    <button type="submit" class="quantity-button decrease-quantity">-</button>
                </form>
                <span class="quantity-display">{{ cart_quantities[item.soapid] }}</span>
                <!-- Form to add to cart -->
                <form action="{{ url_for('add_to_cart') }}" method="POST">
                    <input type="hidden" name="soapid" value="{{ item.soapid }}">
                    <input type="hidden" name="redirect_url" value="{{ request.url }}">
                    <button type="submit" class="quantity-button increase-quantity">+</button>
                </form>
            </div>

            {% else %}
            <!-- If the soap is not in the cart -->
            <form action="{{ url_for('add_to_cart') }}" method="POST">
                <input type="hidden" name="soapid" value="{{ item.soapid }}">
                <input type="hidden" name="redirect_url" value="{{ request.url }}">
                <button type="submit" class="add-to-cart">Add to Cart</button>
            </form>
            {% endif %}

        </li>
        {% endfor %}
    </ul>

    <p class="total-price">Total Price: ${{ total_price }}</p> <!-- Total price for the entire order -->

    {% else %}
    <p>No items found in this order.</p>
    {% endif %}

    <!-- Navigation links -->
    <div class="cart-navigation">
        <a href="{{ url_for('previous_carts') }}"><button>Back to previous orders</button></a>
        <a href="{{ url_for('home') }}"><button>Back to home</button></a>
    </div>
</div>
{% endblock %}